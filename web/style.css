/* ===== RESET & BASE ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg-primary: #0a0a0f;
  --bg-secondary: #12121a;
  --bg-tertiary: #1a1a2e;
  --text-primary: #e8e8f0;
  --text-secondary: #8888a0;
  --text-muted: #55556a;
  --accent: #f59e0b;
  --accent-dim: #b8751a;
  --error: #ef4444;
  --success: #22c55e;
  --border: #2a2a3e;
  --msg-user: #1e293b;
  --msg-agent: #162030;
  --radius: 12px;
  --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-mono: "SF Mono", "Fira Code", "Cascadia Code", monospace;
}

html, body {
  height: 100%; width: 100%;
  font-family: var(--font);
  background: var(--bg-primary);
  color: var(--text-primary);
  overflow: hidden;
  -webkit-tap-highlight-color: transparent;
}

/* ===== SCREENS ===== */
.screen { display: none; height: 100vh; width: 100vw; }
.screen.active { display: flex; flex-direction: column; }

/* ===== LOGIN SCREEN ===== */
#login-screen {
  align-items: center; justify-content: center;
  background: radial-gradient(ellipse at center, #12121a 0%, #0a0a0f 70%);
}

.login-container {
  width: 100%; max-width: 320px; padding: 2rem;
  display: flex; flex-direction: column; align-items: center; gap: 1.5rem;
}

.login-header { text-align: center; }
.logo {
  font-size: 3rem; color: var(--accent);
  filter: drop-shadow(0 0 20px rgba(245, 158, 11, 0.3));
  margin-bottom: 0.5rem;
}
.login-header h1 { font-size: 1.5rem; font-weight: 600; letter-spacing: 0.05em; }
.subtitle { color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.3rem; }

/* PIN dots */
.pin-display { display: flex; gap: 12px; }
.pin-dot {
  width: 16px; height: 16px; border-radius: 50%;
  border: 2px solid var(--border);
  transition: all 0.15s ease;
}
.pin-dot.filled {
  background: var(--accent);
  border-color: var(--accent);
  box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
}
.pin-dot.error { border-color: var(--error); background: var(--error); }

/* PIN pad */
.pin-pad {
  display: grid; grid-template-columns: repeat(3, 1fr);
  gap: 10px; width: 100%; max-width: 260px;
}
.pin-key {
  aspect-ratio: 1.4; border: 1px solid var(--border); border-radius: var(--radius);
  background: var(--bg-secondary); color: var(--text-primary);
  font-size: 1.4rem; font-family: var(--font);
  cursor: pointer; transition: all 0.1s ease;
  display: flex; align-items: center; justify-content: center;
}
.pin-key:active { background: var(--accent); color: var(--bg-primary); transform: scale(0.95); }
.pin-key-empty { visibility: hidden; border: none; }
.pin-key-back { font-size: 1.2rem; color: var(--text-secondary); }

.error-message { color: var(--error); font-size: 0.8rem; min-height: 1.2em; text-align: center; }
.status-message { color: var(--text-muted); font-size: 0.75rem; text-align: center; }
.status-message.connected { color: var(--success); }

/* ===== PASSPHRASE SCREEN ===== */
#passphrase-screen {
  align-items: center; justify-content: center;
  background: radial-gradient(ellipse at center, #12121a 0%, #0a0a0f 70%);
}

.passphrase-form {
  width: 100%; display: flex; flex-direction: column; gap: 0.75rem;
}

.passphrase-input {
  width: 100%; padding: 0.75rem 1rem;
  background: var(--bg-tertiary); color: var(--text-primary);
  border: 1px solid var(--border); border-radius: var(--radius);
  font-family: var(--font); font-size: 1rem;
  outline: none; transition: border-color 0.15s;
}
.passphrase-input:focus { border-color: var(--accent-dim); }
.passphrase-input::placeholder { color: var(--text-muted); }

.btn-passphrase-submit {
  width: 100%; padding: 0.75rem; border: none; border-radius: var(--radius);
  background: var(--accent); color: var(--bg-primary);
  font-family: var(--font); font-size: 1rem; font-weight: 600;
  cursor: pointer; transition: background 0.15s;
}
.btn-passphrase-submit:hover { background: #fbbf24; }

.btn-link {
  background: none; border: none; color: var(--text-secondary);
  font-family: var(--font); font-size: 0.8rem;
  cursor: pointer; text-decoration: underline;
  transition: color 0.15s;
}
.btn-link:hover { color: var(--text-primary); }

/* ===== CHAT SCREEN ===== */
.chat-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.75rem 1rem;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.chat-header-left { display: flex; align-items: center; gap: 0.5rem; }
.agent-indicator {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--success);
  box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
}
#agent-name { font-weight: 600; font-size: 0.95rem; }
.chat-header-right { display: flex; align-items: center; gap: 0.75rem; }
.user-badge {
  font-size: 0.75rem; color: var(--text-secondary);
  background: var(--bg-tertiary); padding: 0.2rem 0.6rem;
  border-radius: 999px; border: 1px solid var(--border);
}
.btn-icon {
  background: none; border: none; color: var(--text-secondary);
  font-size: 1.1rem; cursor: pointer; padding: 0.3rem;
  transition: color 0.15s;
}
.btn-icon:hover { color: var(--error); }

/* Messages area */
.chat-messages {
  flex: 1; overflow-y: auto; padding: 1rem;
  display: flex; flex-direction: column; gap: 0.75rem;
  scroll-behavior: smooth;
}
.chat-messages::-webkit-scrollbar { width: 6px; }
.chat-messages::-webkit-scrollbar-track { background: transparent; }
.chat-messages::-webkit-scrollbar-thumb {
  background: var(--border); border-radius: 3px;
}

/* Message bubbles */
.message { max-width: 85%; padding: 0.75rem 1rem; border-radius: var(--radius); line-height: 1.5; }
.message-user {
  align-self: flex-end; background: var(--msg-user);
  border-bottom-right-radius: 4px;
}
.message-agent {
  align-self: flex-start; background: var(--msg-agent);
  border-bottom-left-radius: 4px;
}
.message-agent .message-text { white-space: pre-wrap; }
.message-system {
  align-self: center; color: var(--text-muted);
  font-size: 0.8rem; font-style: italic;
  padding: 0.3rem 0;
}
.message-thinking {
  align-self: flex-start; color: var(--text-muted);
  font-size: 0.8rem; font-style: italic;
  padding: 0.5rem 1rem; background: var(--bg-tertiary);
  border-radius: var(--radius);
}
.typing-indicator::after {
  content: ""; display: inline-block;
  animation: blink 1.2s infinite;
}
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

/* Inline images in messages */
.message-image-wrapper {
  margin: 0.5rem 0;
}
.message-image {
  max-width: 100%; max-height: 400px;
  border-radius: 8px;
  cursor: pointer;
  transition: opacity 0.15s;
}
.message-image:hover { opacity: 0.85; }
.message-image-caption {
  font-size: 0.75rem; color: var(--text-muted);
  margin-top: 0.25rem; font-style: italic;
}

/* ===== INPUT AREA ===== */
.chat-input-container {
  display: flex; align-items: flex-end; gap: 0.5rem;
  padding: 0.75rem 1rem;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border);
  flex-shrink: 0;
}
#chat-input {
  flex: 1; resize: none; border: 1px solid var(--border);
  border-radius: var(--radius); padding: 0.6rem 0.8rem;
  background: var(--bg-tertiary); color: var(--text-primary);
  font-family: var(--font); font-size: 0.9rem;
  line-height: 1.4; max-height: 120px; overflow-y: auto;
  outline: none; transition: border-color 0.15s;
}
#chat-input:focus { border-color: var(--accent-dim); }
#chat-input::placeholder { color: var(--text-muted); }
.btn-send {
  width: 40px; height: 40px; border: none; border-radius: 50%;
  background: var(--accent); color: var(--bg-primary);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: all 0.15s; flex-shrink: 0;
}
.btn-send:disabled { opacity: 0.3; cursor: not-allowed; }
.btn-send:not(:disabled):hover { background: #fbbf24; transform: scale(1.05); }

/* ===== AUDIT PANEL ===== */
.audit-panel {
  position: fixed; top: 0; right: -100%; width: 100%; max-width: 420px;
  height: 100vh; background: var(--bg-secondary);
  border-left: 1px solid var(--border);
  display: flex; flex-direction: column;
  transition: right 0.25s ease; z-index: 100;
  box-shadow: -4px 0 20px rgba(0,0,0,0.5);
}
.audit-panel.open { right: 0; }

.audit-header {
  display: flex; align-items: center; gap: 0.75rem;
  padding: 0.75rem 1rem;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.audit-header h2 { font-size: 1rem; font-weight: 600; white-space: nowrap; }
.audit-controls { display: flex; gap: 0.5rem; flex: 1; }
.audit-controls select {
  background: var(--bg-tertiary); color: var(--text-primary);
  border: 1px solid var(--border); border-radius: 6px;
  padding: 0.3rem 0.4rem; font-size: 0.75rem;
  font-family: var(--font); outline: none;
}

.audit-entries {
  flex: 1; overflow-y: auto; padding: 0.75rem;
  display: flex; flex-direction: column; gap: 0.5rem;
}
.audit-entry {
  padding: 0.6rem 0.75rem; border-radius: 8px;
  background: var(--bg-tertiary); border: 1px solid var(--border);
  font-size: 0.8rem; line-height: 1.4;
}
.audit-entry-header {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 0.3rem;
}
.audit-entry-who {
  font-weight: 600; color: var(--accent); font-size: 0.75rem;
}
.audit-entry-time {
  color: var(--text-muted); font-size: 0.7rem;
}
.audit-entry-dir {
  display: inline-block; font-size: 0.65rem; padding: 0.1rem 0.35rem;
  border-radius: 4px; margin-right: 0.3rem;
  font-weight: 600; text-transform: uppercase;
}
.audit-entry-dir.inbound { background: #1e3a5f; color: #60a5fa; }
.audit-entry-dir.outbound { background: #1a3328; color: #4ade80; }
.audit-entry-preview {
  color: var(--text-secondary); word-break: break-word;
}
.audit-empty {
  color: var(--text-muted); text-align: center;
  padding: 2rem 1rem; font-style: italic;
}

/* ===== ADMIN PANEL ===== */
.admin-panel {
  position: fixed; top: 0; right: -100%; width: 100%; max-width: 420px;
  height: 100vh; background: var(--bg-secondary);
  border-left: 1px solid var(--border);
  display: flex; flex-direction: column;
  transition: right 0.25s ease; z-index: 110;
  box-shadow: -4px 0 20px rgba(0,0,0,0.5);
}
.admin-panel.open { right: 0; }

.admin-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.75rem 1rem;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.admin-header h2 { font-size: 1rem; font-weight: 600; }

.admin-body {
  flex: 1; overflow-y: auto; padding: 1rem;
  display: flex; flex-direction: column; gap: 1rem;
}

.admin-user-selector label {
  display: block; font-size: 0.75rem; color: var(--text-secondary);
  margin-bottom: 0.3rem;
}
.admin-user-selector select,
#admin-user-select {
  width: 100%; padding: 0.5rem 0.6rem;
  background: var(--bg-tertiary); color: var(--text-primary);
  border: 1px solid var(--border); border-radius: 8px;
  font-family: var(--font); font-size: 0.85rem;
  outline: none;
}

.admin-user-details {
  display: flex; flex-direction: column; gap: 1rem;
}

.admin-section {
  padding: 0.75rem; background: var(--bg-tertiary);
  border: 1px solid var(--border); border-radius: 8px;
}
.admin-section > label {
  display: block; font-size: 0.75rem; color: var(--text-secondary);
  margin-bottom: 0.4rem; font-weight: 600;
}

.admin-row {
  display: flex; gap: 0.5rem; align-items: center;
}

.admin-input {
  flex: 1; padding: 0.4rem 0.6rem;
  background: var(--bg-primary); color: var(--text-primary);
  border: 1px solid var(--border); border-radius: 6px;
  font-family: var(--font); font-size: 0.85rem;
  outline: none; transition: border-color 0.15s;
}
.admin-input:focus { border-color: var(--accent-dim); }

.btn-admin-save, .btn-admin-clear {
  padding: 0.4rem 0.75rem; border: none; border-radius: 6px;
  font-family: var(--font); font-size: 0.75rem; font-weight: 600;
  cursor: pointer; transition: background 0.15s;
  white-space: nowrap;
}
.btn-admin-save {
  background: var(--accent); color: var(--bg-primary);
}
.btn-admin-save:hover { background: #fbbf24; }
.btn-admin-clear {
  background: var(--bg-primary); color: var(--text-secondary);
  border: 1px solid var(--border);
}
.btn-admin-clear:hover { color: var(--error); border-color: var(--error); }

.admin-field-status {
  font-size: 0.7rem; margin-top: 0.3rem;
}
.admin-field-status.set { color: var(--success); }
.admin-field-status.unset { color: var(--text-muted); }

.admin-checkbox-label {
  display: flex !important; align-items: center; gap: 0.5rem;
  font-size: 0.85rem !important; color: var(--text-primary) !important;
  font-weight: 400 !important; cursor: pointer;
  margin-bottom: 0.4rem;
}
.admin-checkbox-label input[type="checkbox"] {
  width: 16px; height: 16px; accent-color: var(--accent);
}

.admin-devices-list {
  display: flex; flex-direction: column; gap: 0.4rem;
}
.admin-device-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.4rem 0.6rem; background: var(--bg-primary);
  border: 1px solid var(--border); border-radius: 6px;
}
.admin-device-mac {
  font-family: var(--font-mono); font-size: 0.8rem;
  color: var(--text-primary);
}
.btn-admin-remove {
  padding: 0.2rem 0.5rem; border: 1px solid var(--border);
  border-radius: 4px; background: transparent;
  color: var(--text-muted); font-size: 0.7rem;
  cursor: pointer; transition: all 0.15s;
}
.btn-admin-remove:hover {
  color: var(--error); border-color: var(--error);
}

.btn-admin-action {
  padding: 0.4rem 0.75rem; border: 1px solid var(--border);
  border-radius: 6px; background: var(--bg-primary);
  color: var(--text-primary); font-family: var(--font);
  font-size: 0.75rem; cursor: pointer; transition: all 0.15s;
}
.btn-admin-action:hover {
  border-color: var(--accent); color: var(--accent);
}
.btn-admin-action.btn-small {
  padding: 0.25rem 0.5rem; font-size: 0.7rem;
}

.admin-empty {
  color: var(--text-muted); font-size: 0.8rem;
  font-style: italic; padding: 0.5rem 0;
}

.admin-add-user-section .admin-row { margin-bottom: 0.4rem; }
.admin-add-user-section .admin-row:last-child { margin-bottom: 0; }

.btn-admin-remove-user {
  width: 100%; padding: 0.5rem; border: 1px solid var(--error);
  border-radius: 6px; background: transparent;
  color: var(--error); font-family: var(--font);
  font-size: 0.8rem; font-weight: 600;
  cursor: pointer; transition: all 0.15s;
}
.btn-admin-remove-user:hover {
  background: var(--error); color: var(--bg-primary);
}

.admin-status {
  font-size: 0.8rem; text-align: center;
  min-height: 1.2em; transition: color 0.15s;
}
.admin-status.success { color: var(--success); }
.admin-status.error { color: var(--error); }

/* ===== LAN DEVICE PICKER MODAL ===== */
.lan-modal {
  position: fixed; inset: 0; z-index: 200;
  background: rgba(0, 0, 0, 0.7);
  display: flex; align-items: center; justify-content: center;
}
.lan-modal-content {
  width: 90%; max-width: 440px; max-height: 70vh;
  background: var(--bg-secondary); border: 1px solid var(--border);
  border-radius: var(--radius); display: flex; flex-direction: column;
  box-shadow: 0 8px 32px rgba(0,0,0,0.6);
}
.lan-modal-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.75rem 1rem;
  border-bottom: 1px solid var(--border);
}
.lan-modal-header h3 { font-size: 0.95rem; font-weight: 600; }
.lan-modal-current {
  padding: 0.5rem 1rem; font-size: 0.75rem; color: var(--text-muted);
  border-bottom: 1px solid var(--border);
}
.lan-device-list {
  flex: 1; overflow-y: auto; padding: 0.5rem;
  display: flex; flex-direction: column; gap: 0.3rem;
}
.lan-device-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.5rem 0.75rem; border-radius: 6px;
  transition: background 0.1s; cursor: default;
}
.lan-device-item:hover { background: var(--bg-tertiary); }
.lan-device-item.current { background: #1a2e1a; }
.lan-device-info {
  font-family: var(--font-mono); font-size: 0.8rem;
  color: var(--text-primary);
}

/* ===== MOBILE ===== */
@media (max-width: 480px) {
  .login-container { padding: 1.5rem; }
  .pin-key { font-size: 1.2rem; }
  .message { max-width: 92%; }
  .chat-header { padding: 0.6rem 0.75rem; }
  .admin-panel, .audit-panel { max-width: 100%; }
}

/* ===== SAFE AREA (notched phones) ===== */
@supports (padding: env(safe-area-inset-bottom)) {
  .chat-input-container { padding-bottom: calc(0.75rem + env(safe-area-inset-bottom)); }
  #login-screen { padding-bottom: env(safe-area-inset-bottom); }
}
